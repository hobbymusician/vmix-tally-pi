# Tally lights for vMix

Python program implementing tally lights for vMix with Raspberry Pi Zero and PIMORONI Unicorn Hat Mini
<p align="center"><img src="https://github.com/hobbymusician/vmix-tally-pi/blob/main/TALLYPI.jpg" width="400"></p>

# Before You Start

You should have a Raspberry Pi Zero WH with Raspberry Pi OS (the "lite" version is sufficient) that is already connected to the network by wifi. Make sure it is in the same IP address subnet like the PC running the vMix software.
Additionally, you will need a PIMORONI UNICORN HAT MINI connected to the GPIO pins of the Pi and install the corresponding software from PIMORONI - see instructions on the [PIMORONI website](https://learn.pimoroni.com/tutorial/hel/getting-started-with-unicorn-hat-mini). I you are using the "lite" version of Raspberry Pi OS, you might need to install the dependencies listed under step 2 under "Installation" first.
Finally, you need to activate the web server of vMix under "Settings | Web Controller". 
The python program in this project will read the corresponding tally website generated by vMix, parse it and control the LEDs according to the current status of the camera input with the corresponding name, i.e. the colors used for the LEDs depend on the settings in vMix.

Part list for this project:
- [Raspberry Pi Zero WH](https://buyzero.de/products/raspberry-pi-zero-wh-mit-bestucktem-header) running Raspberry Pi OS lite, i.e. including SD card for the OS, power supply and adaptors for keyboard and standard HDMI cable. You may also use a Raspberry Pi Zero W and solder the header by your own.
- [Pimoroni Unicorn Hat Mini](https://shop.pimoroni.com/products/unicorn-hat-mini)
- Transparent housing for Raspberry Pi Mini which has enough space for the Unicorn Hat Mini (I was using [this](https://www.amazon.de/gp/product/B07DHCC5NY/ref=ppx_od_dt_b_asin_title_s00?ie=UTF8&psc=1) but others might be feasible as well)

# Installation

1. Open the terminal on your Raspberry Pi
2. Install pip, git and the dependencies for pycurl and for the PIMORONI stuff which are not avaliable on a Raspberry Pi OS Lite(pycurl is used for parsing the web site generated by vMix)
    ```
    sudo apt-get update
    sudo apt-get upgrade
    sudo apt install python-pip
    sudo apt install git
    sudo apt install libcurl4-openssl-dev libssl-dev
    sudo apt install python-pil
    ```
3. Install pycurl
    ```
    pip install pycurl
    ```
    If the above installation procedure should not work, there might be an updated installation procedure [here](http://pycurl.io/docs/latest/install.html#install)
4. Clone this project

    ```
    cd
    git clone https://github.com/hobbymusician/vmix-tally-pi.git
    ```
5. Make the python script executable
   ```
    cd vmix-tally-pi/vmix-tally-pi/
    chmod 755 tally.py
    ```
    The usage of the script is
    ```
    tally.py <camera input name> <ip address of vMix computer> [<port>] 
    ```
    If the port is omitted, it defaults to 8088.
    
    E.g. type the following to connect to the vMix PC IP address 192.168.1.1 to generate the tally light for the camera named "Camera 1":
    ```
    ./tally.py "Camera 1" 192.168.1.1
    ```
    If you would use port 12345 instead of 8088, you would type
    ```
    ./tally.py "Camera 1" 192.168.1.1 12345
    ```
    Press Ctrl + C at any time to exit.

To start the phyhon script automatically when the Raspberry Pi is starting up, you may add it to rc.local:
```
sudo nano /etc/rc.local
```
Add the following line to rc.local just before the final "exit 0" (eventually modify the path if you were using a different one) and save the file using ^O (Ctrl-O):
```
sudo -H -u pi /home/pi/vmix-tally-pi/vmix-tally-pi/tally.py "Camera 1" 192.168.1.1 &
```
That's it!
After a
```
sudo reboot
```
the Raspberry Pi should automatically start the tally light (initially, there might be an error message saying that it could not connect, but as soon as the vMix PC is found and vMix is running, the tally light should light up with the colour shown in vMix and change its color according to the currently active camera.
